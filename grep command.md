# grep command

> Grep command คือคำสั่งที่ใช้ในการค้นหาคำ โดยปกติแล้วจะใช้เพื่อค้นหาว่าไฟล์ไหนมีคำที่เราต้องการหรือไม่ และถ้ามีจะอยู่ที่บรรทัดไหน ซึ่ง grep command นั้นเป็นหนึ่งในคำสั่งที่ถูกใช้และมีประโยชน์ที่สุดใน Linux และ Unix

> [!NOTE]
> คำสั่ง grep นั้นจะมี syntax เป็น
> ```
> grep <option> <word> <file>
> ```
> - `<option>` คือ option ของ grep
> - `<word>` คือคำที่เราต้องการค้นหา
> - `<file>` คือไฟล์ที่เราต้องการทดสอบที่จะค้นหา โดย `<file>` นั้นไม่จำเป็นต้องเป็นไฟล์เดียว อาจจะเป็นการค้นหาในหลายๆไฟล์พร้อมกันได้ก็ได้เช่นกัน

## การค้นหาเบื้องต้น

> หากเราต้องการค้นหาคำว่า `security` จากไฟล์ที่ชื่อว่า `/etc/secplayground` จะใช้คำสั่งเป็น

```
grep security /etc/secplayground
```

> หรือหากต้องการค้นหาคำว่า `root` ภายใน `/etc/passwd` จะใช้คำสั่งเป็น

```
grep root /etc/passwd
```

## การค้นหาแบบ recursively

> หากเราต้องการค้นหาแบบที่ไล่เข้าไปเรื่อยๆจนกระทั่งถึง directory ภายในสุด จะใช้ -r option ยกตัวอย่างคำสั่งในการค้นหาไฟล์ใดๆที่มีคำว่า noob ที่อยู่ภายใต้ /var จะใช้คำสั่งเป็น

```
grep -r "The flag is" /var
```

> หรือ

```
grep -R "The flag is" /var
```

> โดยจะแตกต่างกันคือ `-R` นั้นจะไล่ตาม symlink ไปด้วย

### ตัวอย่างผลลัพธ์

![Screenshot 2024-05-28 103831](https://github.com/Atiwitch15101/Linux-Knowledge/assets/159407312/3b4718f2-b0b8-482c-a2ea-2e67427ac733)

## ค้นหาโดยระบุคำตรงๆ

> โดยปกติแล้วเมื่อเราค้นหาโดยการระบุคำไป ยกตัวอย่างเช่น sec คำสั่ง grep จะค้นหาทั้ง sec1, sec2, sec3, sec4, sec5, security และอื่นๆ หากเราอยากจะระบุการค้นหาด้วย grep แบบให้ตรงตามคำที่เราต้องการเท่านั้นจะใช้เป็น -w option เช่น หากเราต้องการค้นหาเฉพาะคำว่า sec จะใช้คำสั่งเป็น

```
grep -w "sec" file
```

## ค้นหาคำที่แตกต่างกัน

> หากเราต้องการค้นหาคำที่แตกต่างกันเราสามารถใช้คำสั่ง egrep ในการค้นหาได้เป็น

```
egrep -w 'word1|word2' file
```

## ตรวจสอบว่ามีคำซ้ำกี่ครั้ง

> เราสามารถตรวจสอบได้ว่าคำที่เราค้นหานั้นถูกพบในไฟล์ที่เราต้องการค้นหาจำนวนกี่ครั้ง จะใช้ -c option ซึ่งจะใช้คำสั่งเป็น

```
grep -c 'sec' /path/to/file
```

## แสดงว่าอยู่บรรทัดไหน

> โดยปกติแล้วจะไม่มีการบอกว่าคำที่เราค้นหาพบนั้นอยู่บรรทัดไหน หากเราต้องการให้ grep บอกด้วยว่าเจอที่บรรทัดเท่าไหร่ สามารถใช้ -n option ได้ โดยจะใช้คำสั่งเป็น

```
grep -n 'root' /etc/passwd
```

## คัดกรอง output ของคำสั่งใดๆ

> นอกเหนือจากการใช้งานเพื่อหาคำจากไฟล์ใดๆแล้ว คำสั่ง grep สามารถใช้ในการกรอง output ของคำสั่งได้ด้วย โดยใช้คู่กับ shell pipes หรือก็คือ | โดยในที่นี้จะคัดกรองคำว่า blinux จาก history จะใช้คำสั่งเป็น

```
history | grep blinux
```

### ตัวอย่างผลลัพธ์

![Screenshot 2024-05-28 110148](https://github.com/Atiwitch15101/Linux-Knowledge/assets/159407312/407c439d-dce8-4280-bfdb-bcd9f0dfa384)


# grep command และ regular expression

> ยังคงต่อกับ grep command โดยที่เราจะเรียนรู้กันเพิ่มเติมกับ Regular Expression ซึ่งจริงๆแล้วเราสามารถใช้ regular expression นอกเหนือจาก grep ได้เช่นกัน

## Regular Expression

> Regular Expression หรือเรียกสั้นๆว่า regex คือการใช้อักขระพิเศษผสมกับตัวอักษรและตัวเลขเพื่อใช้ในการค้นหา pattern ของคำที่ต้องการ โดยจะมีลักษณะของการใช้งานเป็น

> [!NOTE]
> |    Symbol   |            คำอธิบาย                                                             |
> |     ---     |              ---                                                                |
> |      .      |         แทนตัวอักษรใดๆ                                                           |
> |      ^      |         ตรงจุดเริ่มต้นของ string                                                    |
> |      $      |         ตรงจุดสุดท้ายของ string                                                   |
> |      *      |         ตรงตัวอักษรใดๆจำนวนครั้งใดๆ                                                 |
> |      \      |         แทนอักขระพิเศษ                                                            |
> |      ()     |         การทำ group regular expression                                          |
> |      ?      |         ตรงตัวอักษรแค่ตัวเดียวเท่านั้น                                                  |
> |     {n}     |         ตรงกับตัวอักษรที่ปรากฏขึ้น n ครั้ง                                               |
> |     {n,m}   |         ตรงกับตัวอักษรที่ปรากฏขึ้น n ครั้ง ไม่มากกว่า m ครั้ง                                |
> |     {n,}    |         ตรงกับตัวอักษรที่ปรากฏขึ้น n ครั้งหรือมากกว่านั้น                                    |
> |      +      |         ตรงกับการปรากฏหนึ่งครั้งหรือมากกว่านั้นกับตัวอักษรก่อนหน้า                            |
> |      ?      |         ตรงกับการปรากฏ 0 ครั้งหรือหนึ่งครั้งกับตัวอักษรก่อนหน้า                              |
> |      []     |         ตรงกับตัวอักษรที่อยู่ภายใน []                                                  |
> |     [^]     |         ตรงกับตัวอักษรที่ไม่อยู่ภายใน []                                                |
> |    [c-f]    |         ตรงกับตัวอักษรแบบเป็น range อย่างในตัวอย่างจะเป็น c-f หมายถึง c,d,e,f นั่นเอง       |
> |     \|      |         เป็น OR operation                                                         |

>เพื่อค้นหาไฟล์ที่มีแพทเทิร์นแบบ blinux{xxxxxxxxxx} โดยที่ xxxxxxxxxx คืออักขระ 10 ตัว คุณสามารถใช้คำสั่ง grep ร่วมกับ regular expression (regex) ดังนี้

```
grep -r -E 'blinux\{[a-zA-Z0-9]{10}\}' /home/noob
```

> [!NOTE]
> -`grep` คำสั่งพื้นฐานสำหรับการค้นหา
> - `-r` ค้นหาแบบ recursive (ค้นหาในไดเรกทอรีย่อยด้วย)
> - `-E` ใช้ extended regex
> - `'blinux\{[a-zA-Z0-9]{10}\}'` regex pattern สำหรับค้นหา `blinux{xxxxxxxxxx}`
>   - `blinux\{` ค้นหาคำว่า `blinux{` โดยต้องมีการ escape `{` ด้วย `\`
>   - `[a-zA-Z0-9]{10}` อักขระใดๆ ที่เป็นตัวอักษรเล็ก (a-z), ตัวอักษรใหญ่ (A-Z) หรือเลข (0-9) จำนวน 10 ตัว
>   - `\}` ปิดด้วย `}` โดยต้อง escape ด้วย `\`

### ตัวอย่าง

> ถ้าคุณต้องการค้นหาในไดเรกทอรี /home/noob

```
grep -r -E 'blinux\{[a-zA-Z0-9]{10}\}' /home/noob
```

### ตัวอย่างผลลัพธ์

![Screenshot 2024-05-28 112912](https://github.com/Atiwitch15101/Linux-Knowledge/assets/159407312/8178363b-ccc5-405b-bbf0-b0aff6b36d4a)
